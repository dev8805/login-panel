/* ==========================================
   FIXES CRÍTICOS PARA MÓVIL - MESAS
   Agregar DESPUÉS de mesas.css en el HTML
   ========================================== */

/* ==========================================
   1. MODAL - ALTURA COMPLETA Y RESPONSIVE
   ========================================== */

@media (max-width: 767px) {
    /* Modal ocupa toda la pantalla */
    #modalMesas {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        height: 100dvh !important; /* Dynamic viewport height */
        overflow: hidden !important;
        z-index: 9999 !important;
    }

    #modalMesas .modal-content {
        width: 100% !important;
        height: 100% !important;
        height: 100dvh !important;
        max-height: 100dvh !important;
        border-radius: 0 !important;
        margin: 0 !important;
        display: flex !important;
        flex-direction: column !important;
    }

    /* Header fijo */
    #modalMesas .modal-header {
        flex-shrink: 0;
        padding: 14px 16px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-bottom: 1px solid #e2e8f0;
    }

    #modalMesas .modal-header h3 {
        font-size: 18px;
        font-weight: 700;
    }

    /* Body con scroll */
    #modalBodyMesas {
        flex: 1 !important;
        overflow: hidden !important;
        display: flex !important;
        flex-direction: column !important;
        background: #f8fafc;
    }

    /* ==========================================
       2. LAYOUT - COLUMNA ÚNICA EN MÓVIL
       ========================================== */

    .modal-mesas-layout {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        padding: 0 !important;
        gap: 0 !important;
        overflow: hidden !important;
        position: relative !important;
    }

    /* Panel izquierdo - Grid de mesas */
    .mesas-panel-izquierdo {
        flex: 1 !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        padding: 12px !important;
        -webkit-overflow-scrolling: touch !important;
        padding-bottom: 100px !important; /* Espacio para bottom sheet */
    }

    /* Grid compacto de 2 columnas */
    .modal-mesas-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
    }

    /* ==========================================
       3. BOTTOM SHEET - PANEL DESLIZABLE
       ========================================== */

    .mesas-panel-derecho {
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        height: auto !important;
        max-height: 88vh !important;
        max-height: 88dvh !important;
        z-index: 1001 !important;
        background: #ffffff !important;
        border-radius: 20px 20px 0 0 !important;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(calc(100% - 60px)) !important;
        transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1) !important;
        display: flex !important;
        flex-direction: column !important;
        overflow: hidden !important;
        will-change: transform !important;
    }

    /* Bottom sheet visible */
    .mesas-panel-derecho:not(.oculto),
    .mesas-panel-derecho.visible {
        transform: translateY(0) !important;
    }

    /* Sin transición durante arrastre */
    .mesas-panel-derecho.dragging {
        transition: none !important;
    }

    /* Handle del bottom sheet */
    .bottom-sheet-handle {
        display: flex !important;
        justify-content: center !important;
        padding: 12px 0 8px !important;
        cursor: grab !important;
        touch-action: none !important;
        flex-shrink: 0 !important;
        background: #ffffff !important;
        border-radius: 20px 20px 0 0 !important;
    }

    .bottom-sheet-handle::before {
        content: "" !important;
        width: 40px !important;
        height: 4px !important;
        background: #cbd5e1 !important;
        border-radius: 2px !important;
        transition: all 0.2s !important;
    }

    .bottom-sheet-handle:active::before {
        width: 50px !important;
        background: #94a3b8 !important;
    }

    /* ==========================================
       4. DETALLE - HEADER, BODY Y FOOTER
       ========================================== */

    /* Header compacto */
    .detalle-header {
        flex-shrink: 0 !important;
        padding: 12px 16px !important;
        background: #fafafb !important;
        border-bottom: 1px solid #e2e8f0 !important;
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
    }

    .detalle-titulo {
        font-size: 16px !important;
        font-weight: 700 !important;
        flex-shrink: 0 !important;
    }

    /* Body con scroll */
    .detalle-body {
        flex: 1 !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
        padding: 12px 16px !important;
        background: #fafafb !important;
        min-height: 0 !important;
    }

    /* Lista de productos */
    .productos-lista {
        max-height: none !important;
        border-radius: 10px !important;
    }

    /* Items de productos compactos */
    .producto-item {
        padding: 10px 12px !important;
        min-height: 40px !important;
        height: auto !important;
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
    }

    /* Controles de cantidad */
    .producto-controls {
        height: 30px !important;
        flex-shrink: 0 !important;
    }

    .qty-btn {
        width: 22px !important;
        height: 30px !important;
        font-size: 12px !important;
    }

    .qty-display {
        min-width: 26px !important;
        height: 30px !important;
        font-size: 12px !important;
    }

    /* Footer fijo con buscador */
    .detalle-footer {
        flex-shrink: 0 !important;
        padding: 12px 16px !important;
        padding-bottom: max(12px, env(safe-area-inset-bottom)) !important;
        background: #ffffff !important;
        border-top: 1px solid #e2e8f0 !important;
        gap: 10px !important;
    }

    /* ==========================================
       5. BUSCADOR - OPTIMIZADO PARA MÓVIL
       ========================================== */

    .buscador-mesa-wrapper {
        position: relative !important;
        margin-bottom: 8px !important;
        z-index: 100 !important;
    }

    /* Contenedor del buscador */
    .buscar-producto {
        display: flex !important;
        gap: 8px !important;
        align-items: center !important;
        background: #f8fafc !important;
        padding: 6px 10px !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 10px !important;
        height: 44px !important;
        transition: all 0.2s !important;
    }

    .buscar-producto:focus-within {
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
    }

    /* Controles de cantidad en buscador */
    .producto-controls {
        display: flex !important;
        align-items: center !important;
        border: 1px solid #e2e8f0 !important;
        border-radius: 6px !important;
        height: 30px !important;
        background: white !important;
        flex-shrink: 0 !important;
    }

    .qty-btn-busqueda-minus,
    .qty-btn-busqueda-plus {
        width: 26px !important;
        height: 30px !important;
        cursor: pointer !important;
        font-size: 13px !important;
        color: #64748b !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        user-select: none !important;
        transition: all 0.2s !important;
        background: transparent !important;
    }

    /* Input de cantidad */
    .cantidad-input {
        width: 34px !important;
        height: 100% !important;
        text-align: center !important;
        padding: 0 !important;
        border: none !important;
        border-left: 1px solid #e2e8f0 !important;
        border-right: 1px solid #e2e8f0 !important;
        font-size: 13px !important;
        font-weight: 700 !important;
        outline: none !important;
        background: white !important;
        color: #059669 !important;
    }

    /* Input de búsqueda */
    .input-producto-buscar {
        flex: 1 !important;
        padding: 8px !important;
        border: none !important;
        background: transparent !important;
        font-size: 15px !important;
        font-weight: 500 !important;
        outline: none !important;
        color: #1e293b !important;
        min-width: 0 !important;
    }

    .input-producto-buscar::placeholder {
        color: #94a3b8 !important;
    }

    /* Botón de grabar voz */
    .btn-grabar-voz {
        width: 44px !important;
        height: 44px !important;
        flex-shrink: 0 !important;
        background: linear-gradient(135deg, #5B7FFF 0%, #4A63CC 100%) !important;
        border: none !important;
        border-radius: 10px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        color: white !important;
        cursor: pointer !important;
        transition: all 0.2s !important;
        box-shadow: 0 4px 10px rgba(91, 127, 255, 0.25) !important;
    }

    .btn-grabar-voz span {
        font-size: 20px !important;
    }

    /* ==========================================
       6. RESULTADOS DE BÚSQUEDA
       ========================================== */

    /* Contenedor de resultados - SIEMPRE encima del buscador */
    [id^="resultados-busqueda-"] {
        position: absolute !important;
        bottom: 100% !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-height: 280px !important;
        z-index: 10000 !important;
        background: #ffffff !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
        margin-bottom: 4px !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }

    /* Items de resultados */
    .resultado-producto-item {
        padding: 14px 16px !important;
        border-bottom: 1px solid #f1f5f9 !important;
        cursor: pointer !important;
        background: #ffffff !important;
        transition: background 0.15s !important;
    }

    .resultado-producto-item:hover,
    .resultado-producto-item:active {
        background: #f8fafc !important;
    }

    .resultado-producto-item:last-child {
        border-bottom: none !important;
    }

    /* ==========================================
       7. BOTÓN REGISTRAR VENTA
       ========================================== */

    .btn-primary,
    .btn-registrar-venta-mesa,
    .detalle-footer .btn {
        height: 48px !important;
        font-size: 15px !important;
        font-weight: 700 !important;
        border-radius: 10px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* ==========================================
       8. TARJETAS DE MESA - COMPACTAS
       ========================================== */

    .mesa-card {
        padding: 12px !important;
        min-height: 95px !important;
        gap: 6px !important;
        border-radius: 10px !important;
    }

    .mesa-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 8px !important;
    }

    .mesa-nombre {
        font-size: 14px !important;
        font-weight: 700 !important;
        line-height: 1.3 !important;
        flex: 1 !important;
        min-width: 0 !important;
    }

    .mesa-total {
        font-size: 13px !important;
        font-weight: 700 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
        min-width: 55px !important;
        text-align: right !important;
    }

    .mesa-descripcion-chip {
        font-size: 10px !important;
        padding: 4px 8px !important;
        border-radius: 10px !important;
        max-width: 100% !important;
    }

    /* ==========================================
       9. PREVENIR ZOOM AL HACER FOCUS
       ========================================== */

    input,
    select,
    textarea {
        font-size: 16px !important;
    }

    /* ==========================================
       10. KEYBOARD VISIBILITY - AJUSTES
       ========================================== */

    /* Cuando el teclado está visible */
    .mesas-panel-derecho:focus-within {
        max-height: 92vh !important;
        max-height: 92dvh !important;
    }

    /* Ajustar padding del footer cuando hay input con focus */
    .detalle-footer:has(input:focus),
    .detalle-footer:has(textarea:focus) {
        padding-bottom: 16px !important;
    }

    /* Scroll automático al input cuando gana focus */
    input:focus,
    textarea:focus {
        scroll-margin-bottom: 120px !important;
    }

    /* ==========================================
       11. PREVENIR SCROLL NO DESEADO
       ========================================== */

    /* Cuando el modal está abierto, bloquear scroll del body */
    body:has(#modalMesas.show) {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
    }

    #modalMesas.show {
        overflow: hidden !important;
    }

    /* ==========================================
       12. OVERLAY DESHABILITADO
       ========================================== */

    .bottom-sheet-overlay {
        display: none !important;
    }

    /* ==========================================
       13. EMPTY STATES
       ========================================== */

    .detalle-empty,
    .empty-state {
        padding: 30px 20px !important;
    }

    .empty-icon {
        font-size: 28px !important;
    }

    .empty-text {
        font-size: 13px !important;
        color: #94a3b8 !important;
    }

    /* ==========================================
       14. CONTROLES DEL HEADER
       ========================================== */

    .mesas-header-controls {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
    }

    .status-badge {
        font-size: 10px !important;
        padding: 4px 8px !important;
        border-radius: 12px !important;
    }

    .btn-historial {
        font-size: 11px !important;
        padding: 6px 12px !important;
        min-height: auto !important;
        border-radius: 10px !important;
    }

    /* ==========================================
       15. MODO EDICIÓN - DESCRIPCIÓN
       ========================================== */

    .mesa-card.editando-descripcion {
        min-height: 110px !important;
    }

    .mesa-descripcion-chip.editing {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 6px !important;
        width: 100% !important;
        max-width: 100% !important;
    }

    .mesa-descripcion-input {
        flex: 1 !important;
        font-size: 12px !important;
        padding: 6px 8px !important;
        height: 32px !important;
        border-radius: 6px !important;
        border: 1px solid #e2e8f0 !important;
    }

    .mesa-descripcion-acciones {
        display: flex !important;
        gap: 4px !important;
        flex-shrink: 0 !important;
    }

    .mesa-descripcion-btn {
        width: 32px !important;
        height: 32px !important;
        min-width: 32px !important;
        font-size: 12px !important;
        padding: 0 !important;
        border-radius: 6px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* ==========================================
       16. MEJORAS DE UX TÁCTIL
       ========================================== */

    /* Smooth scroll */
    .mesas-panel-izquierdo,
    .detalle-body,
    .productos-lista,
    [id^="resultados-busqueda-"] {
        scroll-behavior: smooth !important;
    }

    /* Tap highlight */
    .mesa-card,
    .btn,
    .btn-primary,
    .qty-btn,
    .delete-btn,
    .resultado-producto-item {
        -webkit-tap-highlight-color: rgba(99, 102, 241, 0.1) !important;
    }

    /* Área táctil mínima para botones */
    .qty-btn,
    .delete-btn,
    .btn-delete-mesa {
        min-width: 38px !important;
        min-height: 38px !important;
    }

    /* ==========================================
       17. LANDSCAPE MODE
       ========================================== */
}

@media (max-width: 767px) and (orientation: landscape) {
    .mesas-panel-derecho {
        max-height: 92vh !important;
        max-height: 92dvh !important;
    }

    .detalle-body {
        max-height: 35vh !important;
    }

    [id^="resultados-busqueda-"] {
        max-height: 180px !important;
    }
}

/* ==========================================
   18. TABLET - MANTENER PANEL VISIBLE
   ========================================== */

@media (min-width: 768px) and (max-width: 1024px) {
    .mesas-panel-derecho {
        position: relative !important;
        transform: none !important;
        border-radius: 16px !important;
        height: 100% !important;
        max-height: 100% !important;
    }

    .bottom-sheet-handle {
        display: none !important;
    }

    .bottom-sheet-overlay {
        display: none !important;
    }

    .mesas-panel-derecho.oculto {
        opacity: 0.5 !important;
        pointer-events: none !important;
    }
}

/* ==========================================
   19. SCROLLBAR PERSONALIZADO (WEBKIT)
   ========================================== */

@media (max-width: 767px) {
    .mesas-panel-izquierdo::-webkit-scrollbar,
    .detalle-body::-webkit-scrollbar,
    .productos-lista::-webkit-scrollbar,
    [id^="resultados-busqueda-"]::-webkit-scrollbar {
        width: 4px !important;
    }

    .mesas-panel-izquierdo::-webkit-scrollbar-track,
    .detalle-body::-webkit-scrollbar-track,
    .productos-lista::-webkit-scrollbar-track,
    [id^="resultados-busqueda-"]::-webkit-scrollbar-track {
        background: transparent !important;
    }

    .mesas-panel-izquierdo::-webkit-scrollbar-thumb,
    .detalle-body::-webkit-scrollbar-thumb,
    .productos-lista::-webkit-scrollbar-thumb,
    [id^="resultados-busqueda-"]::-webkit-scrollbar-thumb {
        background: #cbd5e1 !important;
        border-radius: 2px !important;
    }
}

/* ==========================================
   20. NAVEGACIÓN POR TECLADO (OPCIONAL)
   ========================================== */

/* Sugerencia seleccionada por teclado */
.resultado-producto-item.sugerencia-seleccionada {
    background: #eef2ff !important;
    border-left: 3px solid #6366f1 !important;
    padding-left: 13px !important;
}
